import { Module, NestModule } from '@nestjs/common'
<% if (databaseOrm === DATABASE_ORM.TYPEORM) { %>import { TypeOrmModule } from '@nestjs/typeorm'<% } %>
<% if (databaseOrm === DATABASE_ORM.MONGOOSE) { %>import { MongooseModule } from '@nestjs/mongoose'<% } %>

import * as modules from './modules'
<% if (databaseOrm !== DATABASE_ORM.NONE) { %>import { getDatabaseOptions } from '<%- orm.importPath -%>' <% } %>
import {ConfigService } from '@webundsoehne/nestjs-util'
<% if (microserviceProvider) { %>import { MicroserviceProviderModule } from '@webundsoehne/nestjs-util-microservices'<% } -%>

/**
  * Utilizes (nestjs-commander)[https://docs.nestjs.com/recipes/nest-commander].
 */
<% if (databaseOrm !== DATABASE_ORM.NONE) { %>export function createCommandModule (mock = false): new(mock: boolean) => NestModule {
<% } else { -%>export function createCommandModule (): new() => NestModule { <% } %>
@Module({
  providers: [
    ConfigService
  ],
  imports: [
    <% if (databaseOrm === DATABASE_ORM.TYPEORM) { %>TypeOrmModule.forRoot(getDatabaseOptions(mock)),<% } -%>
    <% if (databaseOrm === DATABASE_ORM.MONGOOSE) { %>MongooseModule.forRoot(getDatabaseOptions(mock)),<% } -%>
    <% if (microserviceProvider) { %>MicroserviceProviderModule.forRoot({ queue: [] }),<% } -%>
    ...Object.values(modules)
    ]
})
  class CommandModule implements NestModule {
    // eslint-disable-next-line @typescript-eslint/no-empty-function
    async configure (): Promise<any> {}
  }

  return CommandModule
}
