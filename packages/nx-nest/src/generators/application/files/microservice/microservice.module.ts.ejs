import { Module, NestModule, ClassSerializerInterceptor } from '@nestjs/common'
import { APP_FILTER, APP_PIPE, APP_INTERCEPTOR } from '@nestjs/core'

import * as modules from './modules'
import { ConfigService, GlobalExceptionFilter, ExtendedValidationPipe } from '@webundsoehne/nestjs-util'

@Module({
  providers: [
    ConfigService,
    {
      provide: APP_PIPE,
      useClass: ExtendedValidationPipe
    },
    {
      provide: APP_INTERCEPTOR,
      useClass: ClassSerializerInterceptor
    },
    {
      provide: APP_FILTER,
      useClass: GlobalExceptionFilter
    },
    {
      provide: APP_FILTER,
      useClass: RpcGlobalExceptionFilter
    }
  ],
  imports: [
    ...Object.values(modules)
  ]
})
export class MicroservicesModule implements NestModule {
  // eslint-disable-next-line @typescript-eslint/no-empty-function
  async configure (): Promise<any> {}
}
