import { join } from 'node:path'
import type { DataSourceOptions } from 'typeorm'

import { ConfigService } from '@webundsoehne/nestjs-util'

const { directories, ...options } = ConfigService.get('database')
const entitiesDir = join(__dirname, '../entity')
const migrationsDir = join(__dirname, '../migration')

export function getDatabaseOptions (): DataSourceOptions & { cli: { entitiesDir: string, migrationsDir: string } } {
  const databaseOptions: DataSourceOptions = {
    ...options,
    entities: [`${entitiesDir}/*{.ts,.js}`],
    migrations: [`${migrationsDir}/*{.ts,.js}`],
    cli: { entitiesDir, migrationsDir }
  }

return databaseOptions
}
